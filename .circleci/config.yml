version: 2
workflows:
  version: 2
  workflow:
    jobs:
      - test-3.8-mongo3
      - test-3.8-mongo5
      - test-3.10-mongo3
      - test-3.10-mongo5
      - test-3.11-mongo3
      - test-3.11-mongo5
defaults: &defaults
  working_directory: ~/code
  steps:
    - checkout
    - run:
        name: Install dependencies
        command: pip install --user -r test-requirements.txt
    - run:
        name: Test
        command: pytest tests/
jobs:
  test-3.8-mongo3:
    <<: *defaults
    docker:
      - image: cimg/python:3.8
      - image: mongo:3.6.23
  test-3.8-mongo5:
    <<: *defaults
    docker:
      - image: cimg/python:3.8
      - image: mongo:5.0.23
  test-3.10-mongo3:
    <<: *defaults
    docker:
      - image: cimg/python:3.10
      - image: mongo:3.6.23
  test-3.10-mongo5:
    <<: *defaults
    docker:
      - image: cimg/python:3.10
      - image: mongo:5.0.23
  test-3.11-mongo3:
    <<: *defaults
    docker:
      - image: cimg/python:3.11
      - image: mongo:3.6.23
  test-3.11-mongo5:
    <<: *defaults
    docker:
      - image: cimg/python:3.11
      - image: mongo:5.0.23
